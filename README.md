# Puzzle dailies uploader
Пример создания постов в Puzzle через GraphQL

## Описание
Приложение показывает, как создавать посты с прикрепленными файлами (видео, изображения, документы pdf) с помощью api без авторизации пользователя.

Чтобы запустить пример, надо выполнить следующую команду
```bash
uv run --script ./dailies-upload.py --username "user_login" --project "MyAwesomeProject" --path "episode01/shot010" --description "final version 34" --tags "comp" "for_review" --files "path/to/file1" "path/to/file2"
```
#### Параметры:
* `--username` - имя пользователя/логин в Puzzle
* `--project`  - иня проекта
* `--path` - путь к продукту внутри проекта ( должен быть создан заранее )
* `--description` - текст поста
* `--tags` - тэги, которые будут добавлены к посту
* `--files` - файлы, которые будут загружены в Puzzle
* `--src_files` - файлы, пути к которым будут добавлены к тексту поста

## Изменение кода

Для общения с GraphQL-интерфейсом Puzzle программа использует клиент (модуль `puzzle`), созданный инструментом для кодогенерации **ariadne-codegen**. В случае если вам необходимо изменить функционал клиента, не нужно модифицировать вручную код модуля `puzzle`.

Вместо этого необходимо:

1. Убедиться, что файл `schema.graphql` содержит актуальную модель данных.
2. Изменить файл `queries.graphql` так, чтобы он содержал необходимые запросы к БД Puzzle.
3. Выполнить команду для регенерации модуля `puzzle`:

   ```bash
   uv run ariadne-codegen
   ```
> [!IMPORTANT]
> **Важно:** Запуск `ariadne-codegen` является обязательным шагом перед первым запуском приложения и после любых изменений в файлах `schema.graphql` или `queries.graphql`.


## Обновление схемы

Для обновления схемы потребуется установленное приложение cynic-cli, которое можно установить следующей командой (в системе должен быть установлен [Rust](https://rust-lang.org/tools/install/)):

```shell
cargo install --git https://github.com/obmarg/cynic.git cynic-cli
```

После установки cynic-cli выполните в shell команду `./get-schema.sh > schema.graphql`, в корне репозитория. Этот скрипт выполнит аутентификацию на сервере Puzzle и скачает актуальную схему GraphQL в файл `schema.graphql`.

Чтобы скрипт успешно выполнился, необходимо предварительно задать в файле `.env` переменные:
- `PUZZLE_API` — URL GraphQL API сервера Puzzle.
- `PUZZLE_USER_DOMAIN` — домен студии, пустой, если домен не используется.
- `PUZZLE_USERNAME` — имя пользователя.
- `PUZZLE_PASSWORD` — пароль пользователя.

пример файла `.env` приведен в `example.env`.
